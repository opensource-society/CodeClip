<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Code Editor Layout</title>
  <!-- Bootstrap CSS CDN -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        crossorigin="anonymous">
  <!-- Bootstrap Icons CDN for checkmark -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
  <!-- Prism.js CSS for syntax highlighting -->
  <link href="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/themes/prism-tomorrow.min.css" rel="stylesheet" />

  <style>
    /* ==================== Theme Colors ==================== */

    /* Default: Light Mode */
    :root {
      --cc-bg-primary: #ffffff;
      --cc-panel-bg: #f8f9fa;
      --cc-text-light: #212529;
      --cc-text-secondary: #495057;
      --cc-grabber-bg: #dee2e6;
      --cc-heading-challenge: #007bff;
      --cc-heading-code: #28a745;
      --cc-heading-output: #fd7e14;
      --cc-code-area-bg: #f1f3f5;

      --cc-header-bg: #ffffff;
      --cc-header-text: #212529;

      --cc-btn-bg: #ffffff;
      --cc-btn-text: #212529;
      --cc-btn-border: #dee2e6;
      --cc-btn-hover: #f1f3f5;
    }

    /* Dark Mode */
    body.dark {
      --cc-bg-primary: #000000;
      --cc-panel-bg: #1a1a1a;
      --cc-text-light: #f8f9fa;
      --cc-text-secondary: #adb5bd;
      --cc-grabber-bg: #333333;
      --cc-heading-challenge: #4FC3F7;
      --cc-heading-code: #69F0AE;
      --cc-heading-output: #FF8A65;
      --cc-code-area-bg: #121212;

      --cc-header-bg: #1a1a1a;
      --cc-header-text: #f8f9fa;

      --cc-btn-bg: #1a1a1a;
      --cc-btn-text: #f8f9fa;
      --cc-btn-border: #444;
      --cc-btn-hover: #333333;
    }

    /* Apply theme variables */
    body {
      background-color: var(--cc-bg-primary);
      color: var(--cc-text-light);
      transition: background 0.3s, color 0.3s;
      font-family: "Inter", sans-serif;
      overflow: hidden;
    }

    /* Header styling now uses theme vars */
    header.custom-header {
      background: var(--cc-header-bg);
      color: var(--cc-header-text);
      padding: 1rem 0;
      border-bottom: 1px solid #333;
    }

    /* Make nav links follow theme */
    header.custom-header nav a {
      color: var(--cc-header-text) !important;
      text-decoration: none;
      padding: 0.5rem 1rem;
      border-radius: 0.5rem;
      transition: background 0.2s, color 0.2s;
    }

    header.custom-header nav a:hover {
      background: rgba(0, 0, 0, 0.05);
    }

    header.custom-header nav a.active {
      color: #4FC3F7 !important;
      background: rgba(79, 195, 247, 0.1);
    }

    .btn-save {
      background-color: var(--cc-btn-bg);
      color: var(--cc-btn-text);
      border: 1px solid var(--cc-btn-border);
      padding: 6px 16px;
      border-radius: 0.5rem;
      font-size: 0.9rem;
      font-weight: 500;
      transition: background 0.2s, color 0.2s, border-color 0.2s;
    }

    .btn-save:hover {
      background-color: var(--cc-btn-hover);
    }

    .grid-container {
      display: grid;
      grid-template-rows: 1fr;
      grid-template-columns: 1fr 8px 2fr 8px 1fr;
      height: calc(100vh - 80px);
      width: 100vw;
      overflow: hidden;
      padding-top: 0.5rem;
    }

    .panel {
      overflow: scroll;
      padding: 1rem;
      display: flex;
      flex-direction: column;
      border-radius: 0.5rem;
      background-color: var(--cc-panel-bg);
      box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.5) !important;
    }

    .grabber {
      width: 8px;
      height: 100%;
      cursor: ew-resize;
      background-color: var(--cc-grabber-bg);
      z-index: 10;
      transition: background-color 0.2s ease;
      border-radius: 0.25rem;
    }

    .grabber:hover {
      background-color: #a0aec0;
    }

    .text-challenge-heading {
      color: var(--cc-heading-challenge) !important;
    }

    .text-code-heading {
      color: var(--cc-heading-code) !important;
    }

    .text-output-heading {
      color: var(--cc-heading-output) !important;
    }

    #code-editor,
    #output-area {
      background-color: var(--cc-code-area-bg) !important;
      color: var(--cc-text-light) !important;
      border: 1px solid rgba(255, 255, 255, 0.1);
    }

    .btn-custom-blue {
      background-color: #007bff;
      border-color: #007bff;
      color: white;
      transition: background-color 0.2s ease, border-color 0.2s ease;
      padding-bottom: 10px;
    }

    .btn-custom-blue:hover {
      background-color: #0056b3;
      border-color: #0056b3;
    }

    .btn-custom-orange {
      background-color: #fd7e14;
      border-color: #fd7e14;
      color: white;
      transition: background-color 0.2s ease, border-color 0.2s ease;
    }

    .btn-custom-orange:hover {
      background-color: #e66a00;
      border-color: #e66a00;
    }
  </style>
</head>
<body>
  <!-- Header -->
  <header class="custom-header">
    <div class="container-fluid">
      <div style="display: flex; justify-content: space-between; align-items: center;">
        <div style="display: flex; align-items: center; gap: 2rem;">
          <div style="font-size: 1.5rem; font-weight: 700; color: #4FC3F7;">CodeClip</div>
          <nav style="display: flex; gap: 1.5rem;">
            <a href="/CodeClip">Home</a>
            <a href="/CodeClip/pages/challenges.html">Challenges</a>
            <a href="/CodeClip/pages/editor.html" class="active">Editor</a>
            <a href="/CodeClip/pages/profile.html">Profile</a>
          </nav>
        </div>
        <div>
          <!-- Toggle Button -->
          <button id="toggleBtn" style="background: none; border: none; font-size: 1.3rem; cursor: pointer; color: inherit;" onclick="toggleMode()">🌙</button>
          <button id="saveBtn" class="btn-save">Save Code</button>
        </div>
      </div>
    </div>
  </header>

  <!-- Grid Layout -->
  <div id="grid-container" class="grid-container">
    <!-- Left Panel -->
    <div id="left-panel" class="panel m-2">
      <h2 class="h4 mb-3 text-challenge-heading">Challenge Description</h2>
      <div class="text-secondary flex-grow-1">
        <p>Welcome to the coding challenge! Your task is to implement a function that reverses a given string...</p>
        <h3 class="h5 mt-4 text-primary">Requirements:</h3>
        <ul class="list-unstyled ms-4">
          <li><i class="bi bi-check-circle-fill text-success me-2"></i>The function should accept one argument: a string.</li>
          <li><i class="bi bi-check-circle-fill text-success me-2"></i>It should return the reversed string.</li>
          <li><i class="bi bi-check-circle-fill text-success me-2"></i>The solution must be efficient (e.g., O(n) time complexity).</li>
        </ul>
        <h3 class="h5 mt-4 text-primary">Example:</h3>
        <pre class="bg-dark p-3 rounded text-light-emphasis"><code>
function reverseString(str) {
  // Your code here
}

// Example usage:
// reverseString("hello") should return "olleh"
        </code></pre>
      </div>
    </div>

    <!-- Grabber -->
    <div id="grabber-1" class="grabber"></div>

    <!-- Center Panel -->
    <div id="center-panel" class="panel m-2">
      <h2 class="h4 mb-1 text-code-heading">Code Editor</h2>
      <pre id="code-editor" class="bg-dark p-3 rounded flex-grow-1 overflow-auto"><code class="language-javascript" contenteditable="true">
function reverseString(str) {
  // Your code here
  return str.split('').reverse().join('');
}
      </code></pre>
      <button class="btn btn-custom-blue mt-2 px-4 py-2 rounded shadow">Run Code</button>
    </div>

    <!-- Grabber -->
    <div id="grabber-2" class="grabber"></div>

    <!-- Right Panel -->
    <div id="right-panel" class="panel m-2">
      <h2 class="h4 mb-3 text-output-heading">Output / Test Results</h2>
      <div id="output-area" class="flex-grow-1 p-3 rounded overflow-auto mb-2">
        <p class="text-muted">Click "Run Code" to see output here.</p>
      </div>
      <button class="btn btn-custom-orange mt-2 px-4 py-2 rounded shadow">Run Tests</button>
    </div>
  </div>

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" crossorigin="anonymous"></script>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const gridContainer = document.getElementById('grid-container');
      const grabber1 = document.getElementById('grabber-1');
      const grabber2 = document.getElementById('grabber-2');
      const codeEditor = document.querySelector('#code-editor code');
      const saveBtn = document.getElementById('saveBtn');

      // === Load saved code if available ===
      const savedCode = localStorage.getItem('userCode');
      if (savedCode) {
        codeEditor.innerText = savedCode;
        Prism.highlightAll(); // re-highlight syntax
      }

      // === Save button functionality ===
      saveBtn.addEventListener('click', () => {
        const code = codeEditor.innerText;
        localStorage.setItem('userCode', code);
        alert('Code saved successfully!');
      });

      // === Grabber Resize ===
      const handleResize = (e, grabber) => {
        let startX = e.clientX || (e.touches && e.touches[0].clientX);
        let initialGridTemplateColumns = gridContainer.style.gridTemplateColumns || '1fr 8px 2fr 8px 1fr';

        const onMouseMove = (moveEvent) => {
          const currentX = moveEvent.clientX || (moveEvent.touches && moveEvent.touches[0].clientX);
          const deltaX = currentX - startX;

          const columns = initialGridTemplateColumns.split(' ').map(s => s.trim());
          let col1Width, col2Width, col3Width;

          if (grabber === grabber1) {
            col1Width = parseFloat(columns[0].replace('fr', ''));
            col2Width = parseFloat(columns[2].replace('fr', ''));

            const newCol1Width = Math.max(0.1, col1Width + (deltaX / window.innerWidth) * 4);
            const newCol2Width = Math.max(0.1, col2Width - (deltaX / window.innerWidth) * 4);

            gridContainer.style.gridTemplateColumns = `${newCol1Width}fr 8px ${newCol2Width}fr 8px ${columns[4]}`;
          } else if (grabber === grabber2) {
            col2Width = parseFloat(columns[2].replace('fr', ''));
            col3Width = parseFloat(columns[4].replace('fr', ''));

            const newCol2Width = Math.max(0.1, col2Width + (deltaX / window.innerWidth) * 4);
            const newCol3Width = Math.max(0.1, col3Width - (deltaX / window.innerWidth) * 4);

            gridContainer.style.gridTemplateColumns = `${columns[0]} 8px ${newCol2Width}fr 8px ${newCol3Width}fr`;
          }
        };

        const onMouseUp = () => {
          document.removeEventListener('mousemove', onMouseMove);
          document.removeEventListener('mouseup', onMouseUp);
          document.removeEventListener('touchmove', onMouseMove);
          document.removeEventListener('touchend', onMouseUp);
          document.body.style.userSelect = '';
          document.body.style.cursor = '';
        };

        document.addEventListener('mousemove', onMouseMove);
        document.addEventListener('mouseup', onMouseUp);
        document.addEventListener('touchmove', onMouseMove, { passive: false });
        document.addEventListener('touchend', onMouseUp);
        document.body.style.userSelect = 'none';
        document.body.style.cursor = 'ew-resize';
      };

      grabber1.addEventListener('mousedown', (e) => handleResize(e, grabber1));
      grabber1.addEventListener('touchstart', (e) => handleResize(e, grabber1));

      grabber2.addEventListener('mousedown', (e) => handleResize(e, grabber2));
      grabber2.addEventListener('touchstart', (e) => handleResize(e, grabber2));
    });

    // Toggle Light/Dark Mode
    function toggleMode() {
      document.body.classList.toggle("dark");
      let btn = document.getElementById("toggleBtn");
      btn.innerHTML = document.body.classList.contains("dark") ? "☀️" : "🌙";
    }
  </script>

  <!-- Router Script -->
  <script type="module" src="scripts/app.js"></script>
  <!-- Prism.js -->
  <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/prism.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-javascript.min.js"></script>
</body>
</html>
